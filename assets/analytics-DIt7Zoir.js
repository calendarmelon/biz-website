import{d as i}from"./index-D9lviF5g.js";const m=async r=>{try{const t=new Date().toISOString().split("T")[0],a=new Date().toISOString().slice(0,7)+"-01",{data:e,error:s}=await i.from("appointments").select("id, status, total_amount").eq("business_id",r).eq("appointment_date",t);if(s)throw s;const{data:o,error:n}=await i.from("appointments").select("total_amount").eq("business_id",r).eq("status","completed").gte("appointment_date",a);if(n)throw n;const{count:u,error:l}=await i.from("clients").select("id",{count:"exact"}).eq("business_id",r).eq("is_active",!0);if(l)throw l;const{count:y,error:d}=await i.from("employees").select("id",{count:"exact"}).eq("business_id",r).eq("status","active");if(d)throw d;return{data:{todayAppointments:e.length,todayCompletedAppointments:e.filter(c=>c.status==="completed").length,todayRevenue:e.filter(c=>c.status==="completed").reduce((c,p)=>c+parseFloat(p.total_amount),0),monthlyRevenue:o.reduce((c,p)=>c+parseFloat(p.total_amount),0),totalClients:u,totalStaff:y},error:null}}catch(t){return{data:null,error:t.message}}},h=async(r,t,a)=>{try{const{data:e,error:s}=await i.from("appointments").select("appointment_date, total_amount, status").eq("business_id",r).eq("status","completed").gte("appointment_date",t).lte("appointment_date",a).order("appointment_date",{ascending:!0});if(s)throw s;return{data:e.reduce((n,u)=>{const l=u.appointment_date;return n[l]||(n[l]=0),n[l]+=parseFloat(u.total_amount),n},{}),error:null}}catch(e){return{data:null,error:e.message}}},f=async r=>{try{const{data:t,error:a}=await i.rpc("melon_get_business_analytics",{p_business_id:r});if(a)throw a;const e=t&&t.length>0?t[0]:null;return e?{data:{totalVisitors:parseInt(e.total_visitors)||0,pageViews:parseInt(e.page_views)||0,bounceRate:parseFloat(e.bounce_rate)||0}}:{totalVisitors:0,pageViews:0,bounceRate:0}}catch(t){return{data:null,error:t.message}}},w=async r=>{try{const{data:t,error:a}=await i.rpc("melon_get_device_analytics",{p_business_id:r});if(a)throw a;const e={browsers:[],devices:[],os:[]};return t&&t.length>0&&t.forEach(s=>{const o={type:s.type,count:parseInt(s.count)||0};s.category==="browser"?e.browsers.push(o):s.category==="device"?e.devices.push(o):s.category==="os"&&e.os.push(o)}),{data:e,error:null}}catch(t){return{data:null,error:t.message}}},v=async()=>{try{const{data:r,error:t}=await i.rpc("melon_get_app_analytics");if(t)throw t;const a=r&&r.length>0?r[0]:null;return a?{data:{totalVisitors:parseInt(a.total_visitors)||0,pageViews:parseInt(a.page_views)||0,bounceRate:parseFloat(a.bounce_rate)||0},error:null}:{data:{totalVisitors:0,pageViews:0,bounceRate:0},error:null}}catch(r){return{data:null,error:r.message}}},b=async(r=null)=>{try{const{data:t,error:a}=await i.rpc("melon_get_app_device_analytics",{p_page_type:r});if(a)throw a;const e={browsers:[],devices:[],os:[]};return t&&t.length>0&&t.forEach(s=>{const o={type:s.type,count:parseInt(s.count)||0};s.category==="browser"?e.browsers.push(o):s.category==="device"?e.devices.push(o):s.category==="os"&&e.os.push(o)}),{data:e,error:null}}catch(t){return{data:null,error:t.message}}},A=async r=>{try{const{data:t,error:a}=await i.from("app_page_views").select("page_type, session_id, id").eq("application_source",r);if(a)throw a;const e={};return t&&t.length>0&&t.forEach(o=>{const n=o.page_type||"unknown";e[n]||(e[n]={page_type:n,visitors:new Set,views:0}),e[n].visitors.add(o.session_id),e[n].views++}),{data:Object.values(e).map(o=>({page_type:o.page_type,visitors:o.visitors.size,views:o.views})),error:null}}catch(t){return{data:null,error:t.message}}},q=async()=>{try{const{data:r,error:t}=await i.rpc("melon_get_country_analytics");if(t)throw t;return{data:r||[],error:null}}catch(r){return{data:null,error:r.message}}},R=async r=>{try{const{data:t,error:a}=await i.rpc("melon_get_city_analytics",{p_country_code:r});if(a)throw a;return{data:t||[],error:null}}catch(t){return{data:null,error:t.message}}};export{h as a,f as b,w as c,v as d,A as e,b as f,m as g,q as h,R as i};
