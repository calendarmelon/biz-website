import{u as U,j as e,C as O}from"./index-BheFCFOF.js";import{a as p}from"./vendor-CMvHcHbC.js";import{a as Q,u as W}from"./redux-IAqEd8mO.js";import{b as v,a as j,c as S}from"./index.esm-CuCM43ir.js";import{u as X}from"./storage-B4ijfEY4.js";import{f as A,i as M,L as Z,M as ee,u as se,P as ae,e as re,N as oe,m as ie,A as ne,B as le,D as te,E as H,t as ce,G as de,C as L,O as me}from"./DefaultLayout-VyzN2NJU.js";import{g as ue}from"./staff-D8zrfuMw.js";import{b as g,c as t,a as B}from"./CRow-F-29Amx2.js";import{d as Y,e as J,c as G,b as he}from"./CForm-B94iwgBD.js";import{C as K}from"./CCardHeader-CN94IKlH.js";import{c as xe,a as pe}from"./cil-save-CuPF9_Mc.js";import{C as R}from"./CFormCheck-D4I3hOX8.js";import{C as _e}from"./CInputGroup-DHNNS92A.js";import{C as je,a as ge,b as V,c as C,d as fe,e as y}from"./CTable-sLJna4wq.js";import{c as ye}from"./cil-options-sHCm5Gxk.js";import"./cil-user-Ddrdy7PS.js";const be=({service:s,categories:_,onClose:o,onSuccess:P})=>{const{business:c}=U(),{t:r}=X(),[b,f]=p.useState(!1),[F,x]=p.useState(""),[E,T]=p.useState([]),[k,I]=p.useState(!0),[i,N]=p.useState({name:(s==null?void 0:s.name)||"",description:(s==null?void 0:s.description)||"",category_id:(s==null?void 0:s.category_id)||"",price:(s==null?void 0:s.price)||"",duration_minutes:(s==null?void 0:s.duration_minutes)||"",buffer_time_minutes:(s==null?void 0:s.buffer_time_minutes)||0,is_active:(s==null?void 0:s.is_active)!==void 0?s.is_active:!0,is_bookable_online:(s==null?void 0:s.is_bookable_online)!==void 0?s.is_bookable_online:!0,max_advance_booking_days:(s==null?void 0:s.max_advance_booking_days)||30,requires_consultation:(s==null?void 0:s.requires_consultation)||!1,allows_group_booking:(s==null?void 0:s.allows_group_booking)||!1,max_group_size:(s==null?void 0:s.max_group_size)||1,post_booking_message:(s==null?void 0:s.post_booking_message)||"",employee_ids:[]});p.useEffect(()=>{w()},[c==null?void 0:c.id]),p.useEffect(()=>{if(s!=null&&s.employee_services){const n=s.employee_services.map(l=>l.employee_id);N(l=>({...l,employee_ids:n}))}},[s]);const w=async()=>{if(c!=null&&c.id){I(!0);try{const{data:n,error:l}=await ue(c.id,{status:"active"});if(l)console.error("Error loading employees:",l);else{const u=(n||[]).filter(h=>h.role==="junior_employee"||h.role==="senior_employee");T(u)}}catch(n){console.error("Error loading employees:",n)}finally{I(!1)}}},d=n=>{const{name:l,value:u,type:h,checked:a}=n.target;N(m=>({...m,[l]:h==="checkbox"?a:u}))},q=n=>{N(l=>{const u=l.employee_ids.includes(n)?l.employee_ids.filter(h=>h!==n):[...l.employee_ids,n];return{...l,employee_ids:u}})},D=()=>i.name.trim()?!i.price||i.price<=0?(x(r("services.errors.validPriceRequired")),!1):!i.duration_minutes||i.duration_minutes<=0?(x(r("services.errors.validDurationRequired")),!1):!0:(x(r("services.errors.serviceNameRequired")),!1),z=async n=>{if(n.preventDefault(),x(""),!!D()){f(!0);try{const l={...i,business_id:c.id,price:parseFloat(i.price),duration_minutes:parseInt(i.duration_minutes),buffer_time_minutes:parseInt(i.buffer_time_minutes),max_advance_booking_days:parseInt(i.max_advance_booking_days),max_group_size:parseInt(i.max_group_size),category_id:i.category_id||null,currency:(c==null?void 0:c.currency)||"PLN"};let u;s?u=await Z(s.id,l):u=await ee(l),u.error?x(u.error):P(u.data)}catch(l){x(l.message||r("services.errors.genericError"))}finally{f(!1)}}};return e.jsx(g,{children:e.jsx(t,{xs:12,children:e.jsxs(Y,{className:"mb-4",children:[e.jsx(K,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0",children:r(s?"services.form.editService":"services.form.addNewService")}),e.jsxs(B,{color:"secondary",variant:"ghost",onClick:o,children:[e.jsx(v,{icon:xe,className:"me-2"}),r("services.form.back")]})]})}),e.jsxs(J,{children:[F&&e.jsx(G,{color:"danger",dismissible:!0,onClose:()=>x(""),children:F}),e.jsxs(he,{onSubmit:z,children:[e.jsxs(g,{className:"mb-3",children:[e.jsxs(t,{md:8,children:[e.jsxs(j,{htmlFor:"name",children:[r("services.form.serviceName")," *"]}),e.jsx(S,{type:"text",id:"name",name:"name",value:i.name,onChange:d,required:!0})]}),e.jsxs(t,{md:4,children:[e.jsx(j,{htmlFor:"category_id",children:r("services.form.category")}),e.jsxs(A,{id:"category_id",name:"category_id",value:i.category_id,onChange:d,children:[e.jsx("option",{value:"",children:r("services.form.selectCategory")}),_.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))]})]})]}),e.jsx(g,{className:"mb-3",children:e.jsxs(t,{xs:12,children:[e.jsx(j,{htmlFor:"description",children:r("services.form.description")}),e.jsx(M,{id:"description",name:"description",rows:"3",value:i.description,onChange:d})]})}),e.jsxs(g,{className:"mb-3",children:[e.jsxs(t,{md:3,children:[e.jsxs(j,{htmlFor:"price",children:[r("services.form.price")," (",(c==null?void 0:c.currency)||"PLN",") *"]}),e.jsx(S,{type:"number",id:"price",name:"price",step:"0.01",min:"0",value:i.price,onChange:d,required:!0})]}),e.jsxs(t,{md:3,children:[e.jsxs(j,{htmlFor:"duration_minutes",children:[r("services.form.duration")," *"]}),e.jsx(S,{type:"number",id:"duration_minutes",name:"duration_minutes",min:"1",value:i.duration_minutes,onChange:d,required:!0})]}),e.jsxs(t,{md:3,children:[e.jsx(j,{htmlFor:"buffer_time_minutes",children:r("services.form.bufferTime")}),e.jsx(S,{type:"number",id:"buffer_time_minutes",name:"buffer_time_minutes",min:"0",value:i.buffer_time_minutes,onChange:d})]}),e.jsxs(t,{md:3,children:[e.jsx(j,{htmlFor:"max_advance_booking_days",children:r("services.form.maxAdvanceBooking")}),e.jsx(S,{type:"number",id:"max_advance_booking_days",name:"max_advance_booking_days",min:"1",value:i.max_advance_booking_days,onChange:d})]})]}),e.jsx(g,{className:"mb-3",children:e.jsxs(t,{xs:12,children:[e.jsx(j,{htmlFor:"post_booking_message",children:r("services.form.postBookingMessage")}),e.jsx(M,{id:"post_booking_message",name:"post_booking_message",rows:"3",value:i.post_booking_message,onChange:d,placeholder:r("services.form.postBookingMessagePlaceholder")})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{children:r("services.form.assignEmployees")}),k?e.jsx("div",{className:"text-center py-4",children:e.jsx(O,{})}):E.length===0?e.jsx(G,{color:"info",children:r("services.form.noEmployeesAvailable")}):e.jsx("div",{className:"border rounded p-3",children:E.map(n=>e.jsx(R,{id:`employee-${n.id}`,checked:i.employee_ids.includes(n.id),onChange:()=>q(n.id),label:`${n.first_name} ${n.last_name} (${n.role==="senior_employee"?r("services.form.senior"):r("services.form.junior")} ${r("services.form.employee")})`,disabled:b,className:"mb-2"},n.id))})]}),e.jsxs(g,{className:"mb-3",children:[e.jsx(t,{md:4,children:e.jsx(R,{id:"is_active",name:"is_active",label:r("services.form.active"),checked:i.is_active,onChange:d})}),e.jsx(t,{md:4,children:e.jsx(R,{id:"is_bookable_online",name:"is_bookable_online",label:r("services.form.bookableOnline"),checked:i.is_bookable_online,onChange:d})})]}),e.jsxs(g,{className:"mb-3",children:[e.jsx(t,{md:4,children:e.jsx(R,{id:"requires_consultation",name:"requires_consultation",label:r("services.form.requiresConsultation"),checked:i.requires_consultation,onChange:d})}),e.jsx(t,{md:4,children:e.jsx(R,{id:"allows_group_booking",name:"allows_group_booking",label:r("services.form.allowGroupBooking"),checked:i.allows_group_booking,onChange:d})}),i.allows_group_booking&&e.jsxs(t,{md:4,children:[e.jsx(j,{htmlFor:"max_group_size",children:r("services.form.maxGroupSize")}),e.jsx(S,{type:"number",id:"max_group_size",name:"max_group_size",min:"1",value:i.max_group_size,onChange:d})]})]}),e.jsxs("div",{className:"d-grid gap-2 d-md-flex justify-content-md-end",children:[e.jsx(B,{type:"button",color:"secondary",onClick:o,disabled:b,children:r("services.form.cancel")}),e.jsx(B,{type:"submit",color:"primary",disabled:b,children:b?e.jsxs(e.Fragment,{children:[e.jsx(O,{size:"sm",className:"me-2"}),r("services.form.saving")]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{icon:pe,className:"me-2"}),r(s?"services.form.updateService":"services.form.createService")]})})]})]})]})]})})})},qe=()=>{const s=Q(),{business:_}=U(),{t:o}=X();se({pageType:ae.SERVICES});const{services:P,categories:c,loading:r,error:b,filters:f}=W(a=>a.services),[F,x]=p.useState(!1),[E,T]=p.useState(null),[k,I]=p.useState("");p.useEffect(()=>{_!=null&&_.id&&(i(),N())},[_==null?void 0:_.id,f]);const i=async()=>{s({type:"SERVICES_LOADING"});try{const{data:a,error:m}=await re(_.id,f);s(m?{type:"SERVICES_ERROR",payload:m}:{type:"SERVICES_SUCCESS",payload:a||[]})}catch(a){s({type:"SERVICES_ERROR",payload:a.message})}},N=async()=>{try{const{data:a,error:m}=await oe();!m&&a&&s({type:"CATEGORIES_SUCCESS",payload:a})}catch(a){console.error("Failed to load categories:",a)}},w=(a,m)=>{s({type:"SET_SERVICE_FILTERS",payload:{[a]:m}})},d=a=>{T(a),x(!0)},q=async a=>{if(window.confirm(o("services.confirmDelete")))try{const{error:m}=await me(a);s(m?{type:"SERVICES_ERROR",payload:m}:{type:"REMOVE_SERVICE",payload:a})}catch(m){s({type:"SERVICES_ERROR",payload:m.message})}},D=()=>{x(!1),T(null)},z=a=>{s(E?{type:"UPDATE_SERVICE",payload:a}:{type:"ADD_SERVICE",payload:a}),D()},n=a=>a?e.jsx(L,{color:"success",children:o("services.status.active")}):e.jsx(L,{color:"secondary",children:o("services.status.inactive")}),l=a=>a?e.jsx(L,{color:"info",children:o("services.status.bookable")}):e.jsx(L,{color:"warning",children:o("services.status.notBookable")}),u=a=>!a.employee_services||a.employee_services.length===0?o("services.noEmployeesAssigned"):a.employee_services.map($=>`${$.employees.first_name} ${$.employees.last_name}`).join(", "),h=P.filter(a=>a.name.toLowerCase().includes(k.toLowerCase())||a.description&&a.description.toLowerCase().includes(k.toLowerCase()));return F?e.jsx(be,{service:E,categories:c,onClose:D,onSuccess:z}):e.jsx(g,{children:e.jsx(t,{xs:12,children:e.jsxs(Y,{className:"mb-4",children:[e.jsx(K,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0",children:o("services.title")}),e.jsxs(B,{color:"primary",onClick:()=>x(!0),children:[e.jsx(v,{icon:ie,className:"me-2"}),o("services.addService")]})]})}),e.jsxs(J,{children:[b&&e.jsx(G,{color:"danger",dismissible:!0,children:b}),e.jsxs(g,{className:"mb-3",children:[e.jsx(t,{md:4,children:e.jsx(_e,{children:e.jsx(S,{placeholder:o("services.searchPlaceholder"),value:k,onChange:a=>I(a.target.value)})})}),e.jsx(t,{md:3,children:e.jsxs(A,{value:f.category,onChange:a=>w("category",a.target.value),children:[e.jsx("option",{value:"all",children:o("services.filters.allCategories")}),c.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})}),e.jsx(t,{md:2,children:e.jsxs(A,{value:f.status,onChange:a=>w("status",a.target.value),children:[e.jsx("option",{value:"all",children:o("services.filters.allStatus")}),e.jsx("option",{value:"active",children:o("services.filters.active")}),e.jsx("option",{value:"inactive",children:o("services.filters.inactive")})]})}),e.jsx(t,{md:3,children:e.jsxs(A,{value:f.availability,onChange:a=>w("availability",a.target.value),children:[e.jsx("option",{value:"all",children:o("services.filters.allAvailability")}),e.jsx("option",{value:"bookable",children:o("services.filters.bookable")}),e.jsx("option",{value:"not_bookable",children:o("services.filters.notBookable")})]})})]}),r?e.jsx("div",{className:"text-center p-4",children:e.jsx(O,{})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{overflowX:"auto",minHeight:"400px"},children:e.jsxs(je,{hover:!0,children:[e.jsx(ge,{children:e.jsxs(V,{children:[e.jsx(C,{children:o("services.table.name")}),e.jsx(C,{children:o("services.table.price")}),e.jsx(C,{children:o("services.table.duration")}),e.jsx(C,{children:o("services.table.assignedEmployees")}),e.jsx(C,{children:o("services.table.status")}),e.jsx(C,{children:o("services.table.availability")}),e.jsx(C,{children:o("services.table.actions")})]})}),e.jsx(fe,{children:h.length===0?e.jsx(V,{children:e.jsx(y,{colSpan:"7",className:"text-center",children:o("services.noServicesFound")})}):h.map(a=>e.jsxs(V,{children:[e.jsxs(y,{children:[e.jsx("strong",{children:a.name}),a.description&&e.jsxs("div",{className:"small text-muted",children:[a.description.substring(0,60),"..."]})]}),e.jsxs(y,{children:[a.price," ",a.currency||"PLN"]}),e.jsxs(y,{children:[a.duration_minutes," min"]}),e.jsx(y,{children:e.jsx("small",{children:u(a)})}),e.jsx(y,{children:n(a.is_active)}),e.jsx(y,{children:l(a.is_bookable_online)}),e.jsx(y,{children:e.jsxs(ne,{children:[e.jsx(le,{size:"sm",color:"ghost",children:e.jsx(v,{icon:ye})}),e.jsxs(te,{children:[e.jsxs(H,{onClick:()=>d(a),children:[e.jsx(v,{icon:ce,className:"me-2"}),o("services.actions.edit")]}),e.jsxs(H,{onClick:()=>q(a.id),children:[e.jsx(v,{icon:de,className:"me-2"}),o("services.actions.delete")]})]})]})})]},a.id))})]})}),h.length>0&&e.jsx("div",{className:"text-center text-muted py-3",style:{fontSize:"0.875rem",borderTop:"1px solid #d8dbe0"},children:o("services.endOfList",{count:h.length,plural:h.length!==1?"s":""})})]})]})]})})})};export{qe as default};
