import{j as e,C as B,P as y,u as X}from"./index-Bmzq44n2.js";import{a as j}from"./vendor-CMvHcHbC.js";import{a as $,u as K}from"./redux-IAqEd8mO.js";import{a as f,c as N,b}from"./index.esm-Bj1JZA1M.js";import{i as I,d as Q,C as F,z as Y,A as ee,B as se,D as L,s as ae,F as le,n as ie,o as ne,p as re,q as te,G as oe,H as ce,I as de,J as me}from"./DefaultLayout-BZlNdJvo.js";import{u as H}from"./useLocale-Dw1EenQh.js";import{b as he,c as A,d as M,e as R}from"./CForm-BKs0LH0T.js";import{b as _,c,a as D}from"./CRow-CNo-h43X.js";import{C as w}from"./CFormCheck-D8lL2FHz.js";import{C as xe}from"./CCardHeader-DMf64TQU.js";import{C as Ce}from"./CInputGroup-BahsJjVD.js";import{C as je}from"./CInputGroupText-DNYv737w.js";import{C as pe,a as ue,b as P,c as x,d as fe,e as C}from"./CTable-CYUDX5pp.js";import{c as be}from"./cil-options-sHCm5Gxk.js";import{c as _e}from"./cil-check-circle-BlU9eaow.js";import"./staff-BhCdyJb_.js";import"./cil-user-Ddrdy7PS.js";var ge=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M425.706,86.294A240,240,0,0,0,86.294,425.705,240,240,0,0,0,425.706,86.294ZM256,48A207.1,207.1,0,0,1,391.528,98.345L98.345,391.528A207.1,207.1,0,0,1,48,256C48,141.309,141.309,48,256,48Zm0,416a207.084,207.084,0,0,1-134.986-49.887l293.1-293.1A207.084,207.084,0,0,1,464,256C464,370.691,370.691,464,256,464Z' class='ci-primary'/>"],ye=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M479.6,399.716l-81.084-81.084-62.368-25.767A175.014,175.014,0,0,0,368,192c0-97.047-78.953-176-176-176S16,94.953,16,192,94.953,368,192,368a175.034,175.034,0,0,0,101.619-32.377l25.7,62.2L400.4,478.911a56,56,0,1,0,79.2-79.195ZM48,192c0-79.4,64.6-144,144-144s144,64.6,144,144S271.4,336,192,336,48,271.4,48,192ZM456.971,456.284a24.028,24.028,0,0,1-33.942,0l-76.572-76.572-23.894-57.835L380.4,345.771l76.573,76.572A24.028,24.028,0,0,1,456.971,456.284Z' class='ci-primary'/>"],Ne=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M208,16A112.127,112.127,0,0,0,96,128v79.681a80.236,80.236,0,0,0,9.768,38.308l27.455,50.333L60.4,343.656A79.725,79.725,0,0,0,24,410.732V496H312V464H56V410.732a47.836,47.836,0,0,1,21.841-40.246l97.66-63.479-41.64-76.341A48.146,48.146,0,0,1,128,207.681V128a80,80,0,0,1,160,0v79.681a48.146,48.146,0,0,1-5.861,22.985L240.5,307.007,312,353.483V315.317l-29.223-19,27.455-50.334A80.23,80.23,0,0,0,320,207.681V128A112.127,112.127,0,0,0,208,16Z' class='ci-primary'/><polygon fill='var(--ci-primary-color, currentColor)' points='424 400 424 336 392 336 392 400 328 400 328 432 392 432 392 496 424 496 424 432 488 432 488 400 424 400' class='ci-primary'/>"];const ve={first_name:"",last_name:"",email:"",phone:"",notes:"",allergies:"",email_notifications:!0,sms_notifications:!0,marketing_emails:!0},V=({client:l,onSubmit:g,onCancel:a,loading:i,error:v})=>{const{t:n}=H(),[t,k]=j.useState(ve);j.useEffect(()=>{l&&k({first_name:l.first_name||"",last_name:l.last_name||"",email:l.email||"",phone:l.phone||"",notes:l.notes||"",allergies:l.allergies||"",email_notifications:l.email_notifications??!0,sms_notifications:l.sms_notifications??!0,marketing_emails:l.marketing_emails??!0})},[l]);const r=p=>{const{name:T,value:S,type:E,checked:u}=p.target;k(h=>({...h,[T]:E==="checkbox"?u:S}))},m=p=>{p.preventDefault(),g(t)};return e.jsxs(he,{onSubmit:m,children:[v&&e.jsx(A,{color:"danger",className:"mb-3",children:v}),e.jsxs(_,{className:"mb-3",children:[e.jsxs(c,{md:6,children:[e.jsxs(f,{htmlFor:"first_name",children:[n("clients.form.firstName")," *"]}),e.jsx(N,{id:"first_name",name:"first_name",value:t.first_name,onChange:r,required:!0,disabled:i})]}),e.jsxs(c,{md:6,children:[e.jsxs(f,{htmlFor:"last_name",children:[n("clients.form.lastName")," *"]}),e.jsx(N,{id:"last_name",name:"last_name",value:t.last_name,onChange:r,required:!0,disabled:i})]})]}),e.jsxs(_,{className:"mb-3",children:[e.jsxs(c,{md:6,children:[e.jsx(f,{htmlFor:"email",children:n("clients.form.email")}),e.jsx(N,{id:"email",name:"email",type:"email",value:t.email,onChange:r,disabled:i})]}),e.jsxs(c,{md:6,children:[e.jsx(f,{htmlFor:"phone",children:n("clients.form.phone")}),e.jsx(N,{id:"phone",name:"phone",type:"tel",value:t.phone,onChange:r,disabled:i})]})]}),e.jsx(_,{className:"mb-3",children:e.jsxs(c,{children:[e.jsx(f,{htmlFor:"notes",children:n("clients.form.notes")}),e.jsx(I,{id:"notes",name:"notes",rows:"3",value:t.notes,onChange:r,disabled:i})]})}),e.jsx(_,{className:"mb-3",children:e.jsxs(c,{children:[e.jsx(f,{htmlFor:"allergies",children:n("clients.form.allergies")}),e.jsx(I,{id:"allergies",name:"allergies",rows:"2",value:t.allergies,onChange:r,disabled:i})]})}),e.jsxs(_,{className:"mb-3",children:[e.jsx(c,{children:e.jsx(w,{id:"email_notifications",name:"email_notifications",label:n("clients.form.emailNotifications"),checked:t.email_notifications,onChange:r,disabled:i})}),e.jsx(c,{children:e.jsx(w,{id:"sms_notifications",name:"sms_notifications",label:n("clients.form.smsNotifications"),checked:t.sms_notifications,onChange:r,disabled:i})}),e.jsx(c,{children:e.jsx(w,{id:"marketing_emails",name:"marketing_emails",label:n("clients.form.marketingEmails"),checked:t.marketing_emails,onChange:r,disabled:i})})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx(D,{color:"secondary",onClick:a,disabled:i,children:n("clients.form.cancel")}),e.jsx(D,{color:"primary",type:"submit",disabled:i,children:i?e.jsxs(e.Fragment,{children:[e.jsx(B,{size:"sm",className:"me-2"}),n("clients.form.saving")]}):n(l?"clients.form.updateClient":"clients.form.addClient")})]})]})};V.propTypes={client:y.object,onSubmit:y.func.isRequired,onCancel:y.func.isRequired,loading:y.bool,error:y.string};const Oe=()=>{const l=$(),{business:g}=X(),{t:a}=H(),{clients:i,loading:v,error:n,filters:t}=K(s=>s.clients),[k,r]=j.useState(!1),[m,p]=j.useState(null),[T,S]=j.useState(!1),[E,u]=j.useState(null),h=g==null?void 0:g.id;j.useEffect(()=>{h&&Z()},[h,t]);const Z=async()=>{l({type:"CLIENTS_LOADING"});const{data:s,error:o}=await Q(h,t);l(o?{type:"CLIENTS_ERROR",payload:o}:{type:"CLIENTS_SUCCESS",payload:s||[]})},O=s=>{l({type:"SET_CLIENT_FILTERS",payload:{search:s.target.value}})},q=()=>{p(null),u(null),r(!0)},z=s=>{p(s),u(null),r(!0)},G=async s=>{if(window.confirm(a("clients.confirmDelete"))){const{error:o}=await ce(s);o?alert(a("clients.errors.deletingClient")+o):l({type:"REMOVE_CLIENT",payload:s})}},U=async s=>{const{data:o,error:d}=await oe(s.id,!s.is_blocked);d?alert(a("clients.errors.updatingClient")+d):l({type:"UPDATE_CLIENT",payload:o})},J=async s=>{S(!0),u(null);const o={...s,business_id:h};let d;m?d=await de(m.id,o):d=await me(o),S(!1),d.error?u(d.error):(l(m?{type:"UPDATE_CLIENT",payload:d.data}:{type:"ADD_CLIENT",payload:d.data}),r(!1))},W=s=>s||"-";return h?e.jsxs(e.Fragment,{children:[e.jsxs(M,{className:"mb-4",children:[e.jsxs(xe,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("strong",{children:a("clients.title")}),e.jsxs(D,{color:"primary",onClick:q,children:[e.jsx(b,{icon:Ne,className:"me-2"}),a("clients.addClient")]})]}),e.jsxs(R,{children:[e.jsx(_,{className:"mb-3",children:e.jsx(c,{md:6,children:e.jsxs(Ce,{children:[e.jsx(je,{children:e.jsx(b,{icon:ye})}),e.jsx(N,{placeholder:a("clients.searchPlaceholder"),value:t.search,onChange:O})]})})}),n&&e.jsx(A,{color:"danger",className:"mb-3",children:n}),v?e.jsx("div",{className:"text-center py-5",children:e.jsx(B,{color:"primary"})}):i.length===0?e.jsx("div",{className:"text-center py-5 text-muted",children:a("clients.noClientsFound")}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{overflowX:"auto",minHeight:"400px"},children:e.jsxs(pe,{hover:!0,children:[e.jsx(ue,{children:e.jsxs(P,{children:[e.jsx(x,{children:a("clients.table.name")}),e.jsx(x,{children:a("clients.table.email")}),e.jsx(x,{children:a("clients.table.phone")}),e.jsx(x,{children:a("clients.table.bookings")}),e.jsx(x,{children:a("clients.table.totalSpent")}),e.jsx(x,{children:a("clients.table.status")}),e.jsx(x,{style:{width:"80px"},children:a("clients.table.actions")})]})}),e.jsx(fe,{children:i.map(s=>e.jsxs(P,{children:[e.jsx(C,{children:e.jsxs("strong",{children:[s.first_name," ",s.last_name]})}),e.jsx(C,{children:s.email||"-"}),e.jsx(C,{children:W(s.phone)}),e.jsx(C,{children:s.total_bookings||0}),e.jsx(C,{children:s.total_spent?`${s.total_spent.toFixed(2)} PLN`:"0.00 PLN"}),e.jsx(C,{children:s.is_blocked?e.jsx(F,{color:"danger",children:a("clients.status.blocked")}):s.is_active?e.jsx(F,{color:"success",children:a("clients.status.active")}):e.jsx(F,{color:"secondary",children:a("clients.status.inactive")})}),e.jsx(C,{children:e.jsxs(Y,{alignment:"end",direction:"up",children:[e.jsx(ee,{color:"light",size:"sm",children:e.jsx(b,{icon:be})}),e.jsxs(se,{children:[e.jsxs(L,{onClick:()=>z(s),children:[e.jsx(b,{icon:ae,className:"me-2"}),a("clients.actions.edit")]}),e.jsxs(L,{onClick:()=>U(s),children:[e.jsx(b,{icon:s.is_blocked?_e:ge,className:"me-2"}),s.is_blocked?a("clients.actions.unblock"):a("clients.actions.block")]}),e.jsxs(L,{className:"text-danger",onClick:()=>G(s.id),children:[e.jsx(b,{icon:le,className:"me-2"}),a("clients.actions.delete")]})]})]})})]},s.id))})]})}),e.jsx("div",{className:"text-center text-muted py-3",style:{fontSize:"0.875rem",borderTop:"1px solid #d8dbe0"},children:a("clients.endOfList",{count:i.length,plural:i.length!==1?"s":""})})]})]})]}),e.jsxs(ie,{visible:k,onClose:()=>r(!1),size:"lg",children:[e.jsx(ne,{children:e.jsx(re,{children:a(m?"clients.modal.editClient":"clients.modal.addNewClient")})}),e.jsx(te,{children:e.jsx(V,{client:m,onSubmit:J,onCancel:()=>r(!1),loading:T,error:E})})]})]}):e.jsx(M,{children:e.jsx(R,{children:e.jsx(A,{color:"warning",children:a("clients.noBusinessWarning")})})})};export{Oe as default};
