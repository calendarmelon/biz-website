import{u as ge,v as ae,r as V,j as e,C as ne,P as Y}from"./index-BheFCFOF.js";import{a as h}from"./vendor-CMvHcHbC.js";import{a as Ne,u as we}from"./redux-IAqEd8mO.js";import{b as S,a as B,c as q}from"./index.esm-CuCM43ir.js";import{u as ue}from"./storage-B4ijfEY4.js";import{e as Fe,f as he,t as ve,v as Te,w as oe,x as ce,c as ke,a as Re,y as Ee,z as de,C as $,u as De,P as Ae,m as Le,A as Ie,B as Oe,D as qe,E as X,F as Pe,G as He}from"./DefaultLayout-VyzN2NJU.js";import{u as ye,c as Me,d as Be,e as $e,f as ze,g as Ge,r as Ue,h as We}from"./staff-D8zrfuMw.js";import{b as R,c as m,a as J}from"./CRow-F-29Amx2.js";import{d as z,e as G,c as I,b as Ze}from"./CForm-B94iwgBD.js";import{C as xe}from"./CCardHeader-CN94IKlH.js";import{c as _e,a as Ke}from"./cil-save-CuPF9_Mc.js";import{C as te}from"./CInputGroup-DHNNS92A.js";import{C as fe}from"./CInputGroupText-xn97kw0E.js";import{c as je}from"./cil-user-Ddrdy7PS.js";import{C as me}from"./CFormCheck-D4I3hOX8.js";import{C as re,a as ie,b as L,c as y,d as le,e as g}from"./CTable-sLJna4wq.js";import{c as Ve}from"./cil-options-sHCm5Gxk.js";var Xe=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M19.409,431.289v41.468a24.124,24.124,0,0,0,24.1,24.1H76.877A149.445,149.445,0,0,0,183.25,452.792L383.966,252.075l55.846,56.069,22.671-22.582-55.889-56.114,1.287-1.288-.021-.02,63.287-63.287a84.853,84.853,0,0,0,0-120l-4-4a84.852,84.852,0,0,0-120,0l-64.326,64.326L230.947,53.1,208.275,75.68,260.387,128,63.471,324.916A149.449,149.449,0,0,0,19.409,431.289ZM369.774,63.48a52.854,52.854,0,0,1,74.747,0l4,4a52.913,52.913,0,0,1,0,74.745L387.147,203.6,308.4,124.853Zm-85.72,86.107,78.573,78.573-69.176,69.176v-.483H136.788ZM104.788,328.853H261.935L160.623,430.165a117.662,117.662,0,0,1-83.746,34.688H51.409V431.289A117.664,117.664,0,0,1,86.1,347.543Z' class='ci-primary'/>"],Se=["512 512","<path fill='var(--ci-primary-color, currentColor)' d='M449.366,89.648l-.685-.428L362.088,46.559,268.625,171.176l43,57.337a88.529,88.529,0,0,1-83.115,83.114l-57.336-43L46.558,362.088l42.306,85.869.356.725.429.684a25.085,25.085,0,0,0,21.393,11.857h22.344A327.836,327.836,0,0,0,461.222,133.386V111.041A25.084,25.084,0,0,0,449.366,89.648Zm-20.144,43.738c0,163.125-132.712,295.837-295.836,295.837h-18.08L87,371.76l84.18-63.135,46.867,35.149h5.333a120.535,120.535,0,0,0,120.4-120.4v-5.333l-35.149-46.866L371.759,87l57.463,28.311Z' class='ci-primary'/>"];const Ye=i=>i.toLowerCase().replace(/_([a-z])/g,(_,s)=>s.toUpperCase()),pe=(i,_=null)=>{if(i&&typeof i=="string")return`staff.errors.${Ye(i)}`;if(_){const s=_.toLowerCase();if(s.includes("email")&&s.includes("already")||s.includes("duplicate"))return"staff.errors.emailAlreadyExists";if(s.includes("user")&&s.includes("already exists"))return"staff.errors.userAlreadyExists";if(s.includes("invalid email")||s.includes("email format"))return"staff.errors.invalidEmailFormat";if(s.includes("first name")&&s.includes("required"))return"staff.errors.firstNameRequired";if(s.includes("last name")&&s.includes("required"))return"staff.errors.lastNameRequired";if(s.includes("email")&&s.includes("required"))return"staff.errors.emailRequired";if(s.includes("business id")&&s.includes("required"))return"staff.errors.businessIdRequired";if(s.includes("staff id")&&s.includes("required")||s.includes("employee id"))return"staff.errors.staffIdRequired";if(s.includes("failed to send invitation"))return"staff.errors.failedToSendInvitation";if(s.includes("failed to update employee"))return"staff.errors.failedToUpdateEmployee";if(s.includes("service update failed")||s.includes("service assignment failed"))return"staff.errors.serviceUpdateFailed";if(s.includes("network")||s.includes("fetch"))return"staff.errors.networkError";if(s.includes("permission")||s.includes("unauthorized")||s.includes("forbidden"))return"staff.errors.permissionDenied";if(s.includes("token")&&s.includes("expired"))return"staff.errors.tokenExpired";if(s.includes("invalid data")||s.includes("validation"))return"staff.errors.invalidData";if(s.includes("not found"))return"staff.errors.staffNotFound"}return"staff.errors.genericError"},be=({staff:i=null,onClose:_,onSuccess:s})=>{const{business:r,user:o}=ge(),{t:l}=ue(),[d,U]=h.useState(!1),[b,C]=h.useState(""),[P,D]=h.useState(""),[A,N]=h.useState([]),[w,T]=h.useState(!0),[x,O]=h.useState({first_name:"",last_name:"",email:"",phone:"",role:V.junior_employee,commission_rate:10,is_available_for_booking:!0,working_hours:ae,service_ids:[]}),[F,W]=h.useState(ae),[Q,H]=h.useState({date:"",reason:""});h.useEffect(()=>{Z()},[r==null?void 0:r.id]),h.useEffect(()=>{if(i){const a=i.employee_services?i.employee_services.map(f=>f.service_id):[];O({first_name:i.first_name||"",last_name:i.last_name||"",email:i.email||"",phone:i.phone||"",role:i.role||V.junior_employee,commission_rate:i.commission_rate||0,is_available_for_booking:i.is_available_for_booking!==!1,working_hours:i.working_hours||ae,service_ids:a}),W(i.working_hours||ae)}},[i]);const Z=async()=>{if(r!=null&&r.id){T(!0);try{const{data:a,error:f}=await Fe(r.id);f?console.error("Error loading services:",f):N(a||[])}catch(a){console.error("Error loading services:",a)}finally{T(!1)}}},k=(a,f)=>{O(v=>({...v,[a]:f}))},n=a=>{O(f=>{const v=f.service_ids.includes(a)?f.service_ids.filter(M=>M!==a):[...f.service_ids,a];return{...f,service_ids:v}})},c=(a,f,v)=>{const E={...F[a]||{},[f]:v};if(E.start&&E.end&&E.end<=E.start){const K=t[a]||a;D(`Warning: ${K} end time (${E.end}) should be after start time (${E.start}). Please use 24-hour format (e.g., 16:00 for 4 PM).`)}else D("");const ee={...F,[a]:E};W(ee),O(K=>({...K,working_hours:ee}))},j=()=>x.first_name.trim()?x.last_name.trim()?x.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(x.email)?x.commission_rate<0||x.commission_rate>100?(C(l("staff.errors.commissionRateInvalid")),!1):!0:(C(l("staff.errors.validEmailRequired")),!1):(C(l("staff.errors.emailRequired")),!1):(C(l("staff.errors.lastNameRequired")),!1):(C(l("staff.errors.firstNameRequired")),!1),u=async a=>{if(a.preventDefault(),C(""),!!j()){U(!0);try{const f={...x,business_id:r.id,working_hours:F,created_by:o.id,updated_by:o.id};let v;if(i?v=await ye(i.id,f):v=await Me(f),v.error){const M=pe(v.errorCode,v.error);C(l(M))}else s(v.data)}catch(f){const v=pe(null,f.message);C(l(v))}finally{U(!1)}}},t={monday:l("staff.days.monday"),tuesday:l("staff.days.tuesday"),wednesday:l("staff.days.wednesday"),thursday:l("staff.days.thursday"),friday:l("staff.days.friday"),saturday:l("staff.days.saturday"),sunday:l("staff.days.sunday")},p=[{value:V.manager,label:l("staff.roles.manager")},{value:V.reception,label:l("staff.roles.reception")},{value:V.senior_employee,label:l("staff.roles.seniorEmployee")},{value:V.junior_employee,label:l("staff.roles.juniorEmployee")}];return e.jsx(R,{children:e.jsx(m,{xs:12,children:e.jsxs(z,{className:"mb-4",children:[e.jsx(xe,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0",children:l(i?"staff.form.editStaff":"staff.form.addNewStaff")}),e.jsxs(J,{color:"light",onClick:_,disabled:d,children:[e.jsx(S,{icon:_e,className:"me-2"}),l("staff.form.back")]})]})}),e.jsxs(G,{children:[b&&e.jsx(I,{color:"danger",dismissible:!0,onClose:()=>C(""),children:b}),P&&e.jsx(I,{color:"warning",dismissible:!0,onClose:()=>D(""),children:P}),e.jsxs(Ze,{onSubmit:u,children:[e.jsxs(R,{children:[e.jsx(m,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(B,{htmlFor:"first_name",children:[l("staff.form.firstName")," *"]}),e.jsxs(te,{children:[e.jsx(fe,{children:e.jsx(S,{icon:je})}),e.jsx(q,{type:"text",id:"first_name",placeholder:l("staff.form.firstNamePlaceholder"),value:x.first_name,onChange:a=>k("first_name",a.target.value),required:!0,disabled:d})]})]})}),e.jsx(m,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(B,{htmlFor:"last_name",children:[l("staff.form.lastName")," *"]}),e.jsxs(te,{children:[e.jsx(fe,{children:e.jsx(S,{icon:je})}),e.jsx(q,{type:"text",id:"last_name",placeholder:l("staff.form.lastNamePlaceholder"),value:x.last_name,onChange:a=>k("last_name",a.target.value),required:!0,disabled:d})]})]})})]}),e.jsxs(R,{children:[e.jsx(m,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(B,{htmlFor:"email",children:[l("staff.form.email")," *"]}),e.jsx(q,{type:"email",id:"email",placeholder:l("staff.form.emailPlaceholder"),value:x.email,onChange:a=>k("email",a.target.value),required:!0,disabled:d||i}),i&&e.jsx("small",{className:"text-muted",children:l("staff.form.emailCannotChange")})]})}),e.jsx(m,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(B,{htmlFor:"phone",children:l("staff.form.phone")}),e.jsxs(te,{children:[e.jsx(fe,{children:e.jsx(S,{icon:Se})}),e.jsx(q,{type:"tel",id:"phone",placeholder:l("staff.form.phonePlaceholder"),value:x.phone,onChange:a=>k("phone",a.target.value),disabled:d})]})]})})]}),e.jsxs(R,{children:[e.jsx(m,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(B,{htmlFor:"role",children:[l("staff.form.role")," *"]}),e.jsx(he,{id:"role",value:x.role,onChange:a=>k("role",a.target.value),required:!0,disabled:d,children:p.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]})}),e.jsx(m,{md:6,children:e.jsxs("div",{className:"mb-3",children:[e.jsx(B,{htmlFor:"commission_rate",children:l("staff.form.commissionRate")}),e.jsx(q,{type:"number",id:"commission_rate",min:"0",max:"100",step:"0.1",value:x.commission_rate,onChange:a=>k("commission_rate",parseFloat(a.target.value)||0),disabled:d})]})})]}),e.jsx(R,{className:"mb-4",children:e.jsx(m,{xs:12,children:e.jsx(me,{id:"is_available_for_booking",checked:x.is_available_for_booking,onChange:a=>k("is_available_for_booking",a.target.checked),label:l("staff.form.availableForBooking"),disabled:d})})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{children:l("staff.form.assignedServices")}),w?e.jsx("div",{className:"text-center py-4",children:e.jsx(ne,{})}):A.length===0?e.jsx(I,{color:"info",children:l("staff.form.noServicesAvailable")}):e.jsx("div",{className:"border rounded p-3",children:A.map(a=>e.jsx(me,{id:`service-${a.id}`,checked:x.service_ids.includes(a.id),onChange:()=>n(a.id),label:`${a.name} - ${a.duration_minutes} min - ${a.price} PLN`,disabled:d,className:"mb-2"},a.id))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{children:l("staff.form.workingHours")}),Object.entries(t).map(([a,f])=>{var v,M,E,ee,K;return e.jsxs(R,{className:"mb-2 align-items-center",children:[e.jsx(m,{md:2,children:e.jsx(B,{className:"mb-0",children:f})}),e.jsx(m,{md:2,children:e.jsx(me,{checked:((v=F[a])==null?void 0:v.available)!==!1,onChange:se=>c(a,"available",se.target.checked),label:l("staff.form.available"),disabled:d})}),e.jsx(m,{md:3,children:e.jsx(q,{type:"time",value:((M=F[a])==null?void 0:M.start)||"09:00",onChange:se=>c(a,"start",se.target.value),disabled:d||!((E=F[a])!=null&&E.available)})}),e.jsx(m,{md:3,children:e.jsx(q,{type:"time",value:((ee=F[a])==null?void 0:ee.end)||"17:00",onChange:se=>c(a,"end",se.target.value),disabled:d||!((K=F[a])!=null&&K.available)})})]},a)})]}),b&&e.jsx(I,{color:"danger",dismissible:!0,onClose:()=>C(""),children:b}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx(J,{type:"button",color:"secondary",onClick:_,disabled:d,children:l("staff.form.cancel")}),e.jsx(J,{type:"submit",color:"primary",disabled:d,children:d?e.jsxs(e.Fragment,{children:[e.jsx(ne,{size:"sm",className:"me-2"}),l(i?"staff.form.updating":"staff.form.creating")]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{icon:Ke,className:"me-2"}),l(i?"staff.form.updateStaff":"staff.form.createStaff")]})})]})]})]})]})})})};be.propTypes={staff:Y.object,onClose:Y.func.isRequired,onSuccess:Y.func.isRequired};const Ce=({staffId:i,onBack:_,onEdit:s})=>{const{t:r}=ue(),[o,l]=h.useState(null),[d,U]=h.useState([]),[b,C]=h.useState(null),[P,D]=h.useState(!0),[A,N]=h.useState(""),[w,T]=h.useState("details");h.useEffect(()=>{i&&x()},[i]),h.useEffect(()=>{w==="schedule"&&o?O():w==="performance"&&o&&F()},[w,o]);const x=async()=>{D(!0),N("");try{const{data:n,error:c}=await Be(i);c?N(c):l(n)}catch(n){N(n.message)}finally{D(!1)}},O=async()=>{const n=new Date,c=n.toISOString().split("T")[0],j=new Date(n.getTime()+336*60*60*1e3).toISOString().split("T")[0];try{const{data:u,error:t}=await $e(i,c,j);t?N(t):U(u||[])}catch(u){N(u.message)}},F=async()=>{const n=new Date,c=new Date(n.getTime()-720*60*60*1e3).toISOString().split("T")[0],j=n.toISOString().split("T")[0];try{const{data:u,error:t}=await ze(i,c,j);t?N(t):C(u)}catch(u){N(u.message)}},W=n=>{const j={active:{color:"success",text:r("staff.status.active")},invited:{color:"warning",text:r("staff.status.invited")},inactive:{color:"secondary",text:r("staff.status.inactive")},terminated:{color:"danger",text:r("staff.status.terminated")}}[n]||{color:"secondary",text:n};return e.jsx($,{color:j.color,children:j.text})},Q=n=>{const j={owner:{color:"primary",text:r("staff.roles.owner")},manager:{color:"info",text:r("staff.roles.manager")},reception:{color:"success",text:r("staff.roles.reception")},senior_employee:{color:"warning",text:r("staff.roles.seniorEmployee")},junior_employee:{color:"secondary",text:r("staff.roles.juniorEmployee")}}[n]||{color:"secondary",text:n};return e.jsx($,{color:j.color,children:j.text})},H=n=>new Date(`2000-01-01T${n}`).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),Z=n=>new Date(n).toLocaleDateString(),k=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"];return P?e.jsx("div",{className:"text-center p-4",children:e.jsx(ne,{})}):A?e.jsx(I,{color:"danger",children:A}):o?e.jsx(R,{children:e.jsx(m,{xs:12,children:e.jsxs(z,{className:"mb-4",children:[e.jsx(xe,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0",children:r("staff.details.title")}),e.jsxs("div",{children:[e.jsxs(J,{color:"primary",size:"sm",className:"me-2",onClick:()=>s(o),children:[e.jsx(S,{icon:ve,className:"me-2"}),r("staff.actions.edit")]}),e.jsxs(J,{color:"secondary",variant:"ghost",onClick:_,children:[e.jsx(S,{icon:_e,className:"me-2"}),r("staff.form.back")]})]})]})}),e.jsxs(G,{children:[e.jsxs(Te,{variant:"tabs",className:"mb-3",children:[e.jsx(oe,{children:e.jsx(ce,{active:w==="details",onClick:()=>T("details"),style:{cursor:"pointer"},children:r("staff.details.tabs.details")})}),e.jsx(oe,{children:e.jsxs(ce,{active:w==="schedule",onClick:()=>T("schedule"),style:{cursor:"pointer"},children:[e.jsx(S,{icon:ke,className:"me-2"}),r("staff.details.tabs.schedule")]})}),e.jsx(oe,{children:e.jsxs(ce,{active:w==="performance",onClick:()=>T("performance"),style:{cursor:"pointer"},children:[e.jsx(S,{icon:Re,className:"me-2"}),r("staff.details.tabs.performance")]})})]}),e.jsxs(Ee,{children:[e.jsx(de,{visible:w==="details",children:e.jsxs(R,{children:[e.jsxs(m,{md:6,children:[e.jsx("h5",{children:r("staff.details.personalInfo")}),e.jsx("table",{className:"table table-borderless",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("strong",{children:[r("staff.details.name"),":"]})}),e.jsxs("td",{children:[o.first_name," ",o.last_name]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("strong",{children:[r("staff.details.email"),":"]})}),e.jsx("td",{children:o.email})]}),o.phone&&e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("strong",{children:[r("staff.details.phone"),":"]})}),e.jsxs("td",{children:[e.jsx(S,{icon:Se,className:"me-2"}),o.phone]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("strong",{children:[r("staff.details.role"),":"]})}),e.jsx("td",{children:Q(o.role)})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("strong",{children:[r("staff.details.status"),":"]})}),e.jsx("td",{children:W(o.status)})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("strong",{children:[r("staff.details.commissionRate"),":"]})}),e.jsxs("td",{children:[o.commission_rate,"%"]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("strong",{children:[r("staff.details.availableForBooking"),":"]})}),e.jsx("td",{children:e.jsx($,{color:o.is_available_for_booking?"success":"secondary",children:o.is_available_for_booking?r("staff.details.yes"):r("staff.details.no")})})]}),o.joined_at&&e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("strong",{children:[r("staff.details.joined"),":"]})}),e.jsx("td",{children:Z(o.joined_at)})]})]})})]}),e.jsxs(m,{md:6,children:[e.jsx("h5",{children:r("staff.details.workingHours")}),e.jsxs(re,{small:!0,children:[e.jsx(ie,{children:e.jsxs(L,{children:[e.jsx(y,{children:r("staff.details.day")}),e.jsx(y,{children:r("staff.details.hours")})]})}),e.jsx(le,{children:o.working_hours&&k.map(n=>{const c=o.working_hours[n];return c?e.jsxs(L,{children:[e.jsx(g,{className:"text-capitalize",children:r(`staff.days.${n}`)}),e.jsx(g,{children:c.available===!1?e.jsx($,{color:"secondary",children:r("staff.details.notWorking")}):`${H(c.start)} - ${H(c.end)}`})]},n):null})})]}),o.employee_services&&o.employee_services.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("h5",{className:"mt-4",children:r("staff.details.assignedServices")}),e.jsxs(re,{small:!0,children:[e.jsx(ie,{children:e.jsxs(L,{children:[e.jsx(y,{children:r("staff.details.service")}),e.jsx(y,{children:r("staff.details.price")}),e.jsx(y,{children:r("staff.details.duration")})]})}),e.jsx(le,{children:o.employee_services.map(n=>{var c,j,u;return e.jsxs(L,{children:[e.jsx(g,{children:(c=n.services)==null?void 0:c.name}),e.jsxs(g,{children:["PLN ",(j=n.services)==null?void 0:j.price]}),e.jsxs(g,{children:[(u=n.services)==null?void 0:u.duration_minutes," min"]})]},n.id)})})]})]})]})]})}),e.jsxs(de,{visible:w==="schedule",children:[e.jsx("h5",{children:r("staff.details.schedule.title")}),d.length===0?e.jsx(I,{color:"info",children:r("staff.details.schedule.noAppointments")}):e.jsxs(re,{hover:!0,children:[e.jsx(ie,{children:e.jsxs(L,{children:[e.jsx(y,{children:r("staff.details.schedule.date")}),e.jsx(y,{children:r("staff.details.schedule.time")}),e.jsx(y,{children:r("staff.details.schedule.client")}),e.jsx(y,{children:r("staff.details.schedule.service")}),e.jsx(y,{children:r("staff.details.schedule.duration")}),e.jsx(y,{children:r("staff.details.schedule.status")})]})}),e.jsx(le,{children:d.map(n=>{var c,j,u;return e.jsxs(L,{children:[e.jsx(g,{children:Z(n.appointment_date)}),e.jsx(g,{children:H(n.start_time)}),e.jsxs(g,{children:[(c=n.clients)==null?void 0:c.first_name," ",(j=n.clients)==null?void 0:j.last_name]}),e.jsx(g,{children:(u=n.services)==null?void 0:u.name}),e.jsxs(g,{children:[n.duration_minutes," min"]}),e.jsx(g,{children:e.jsx($,{color:n.status==="completed"?"success":"primary",children:n.status})})]},n.id)})})]})]}),e.jsxs(de,{visible:w==="performance",children:[e.jsx("h5",{children:r("staff.details.performance.title")}),b?e.jsxs(R,{children:[e.jsx(m,{md:3,children:e.jsx(z,{className:"text-center",children:e.jsxs(G,{children:[e.jsx("h4",{className:"text-primary",children:b.total_appointments}),e.jsx("p",{className:"text-muted mb-0",children:r("staff.details.performance.totalAppointments")})]})})}),e.jsx(m,{md:3,children:e.jsx(z,{className:"text-center",children:e.jsxs(G,{children:[e.jsx("h4",{className:"text-success",children:b.completed_appointments}),e.jsx("p",{className:"text-muted mb-0",children:r("staff.details.performance.completed")})]})})}),e.jsx(m,{md:3,children:e.jsx(z,{className:"text-center",children:e.jsxs(G,{children:[e.jsxs("h4",{className:"text-info",children:[b.completion_rate.toFixed(1),"%"]}),e.jsx("p",{className:"text-muted mb-0",children:r("staff.details.performance.completionRate")})]})})}),e.jsx(m,{md:3,children:e.jsx(z,{className:"text-center",children:e.jsxs(G,{children:[e.jsxs("h4",{className:"text-warning",children:["PLN ",b.total_revenue.toFixed(2)]}),e.jsx("p",{className:"text-muted mb-0",children:r("staff.details.performance.totalRevenue")})]})})})]}):e.jsx(I,{color:"info",children:r("staff.details.performance.loading")})]})]})]})]})})}):e.jsx(I,{color:"warning",children:r("staff.errors.staffNotFound")})};Ce.propTypes={staffId:Y.string.isRequired,onBack:Y.func.isRequired,onEdit:Y.func.isRequired};const xs=()=>{const i=Ne(),{business:_}=ge(),{t:s}=ue();De({pageType:Ae.STAFF});const{staff:r,loading:o,error:l,filters:d}=we(t=>t.staff),[U,b]=h.useState(!1),[C,P]=h.useState(null),[D,A]=h.useState(null),[N,w]=h.useState("");h.useEffect(()=>{_!=null&&_.id&&T()},[_==null?void 0:_.id,d]);const T=async()=>{console.log("[todo loadStaff()]"),i({type:"STAFF_LOADING"});try{const{data:t,error:p}=await Ge(_.id,d);console.log("[todo loadStaff()] getStaff ",{data:t,error:p}),p?(console.log("[todo loadStaff] STAFF_ERROR"),i({type:"STAFF_ERROR",payload:p})):(console.log("[todo loadStaff] STAFF_SUCCESS"),i({type:"STAFF_SUCCESS",payload:t||[]}))}catch(t){i({type:"STAFF_ERROR",payload:t.message})}},x=(t,p)=>{i({type:"SET_STAFF_FILTERS",payload:{[t]:p}})},O=t=>{A(t)},F=t=>{P(t),b(!0)},W=async t=>{if(window.confirm(s("staff.confirmDelete")))try{i({type:"STAFF_LOADING"});const{error:p}=await We(t);p?i({type:"STAFF_ERROR",payload:p}):await T()}catch(p){i({type:"STAFF_ERROR",payload:p.message})}},Q=async(t,p)=>{try{i({type:"STAFF_LOADING"});const{data:a,error:f}=await ye(t,{status:p});f?i({type:"STAFF_ERROR",payload:f}):await T()}catch(a){i({type:"STAFF_ERROR",payload:a.message})}},H=()=>{b(!1),P(null)},Z=()=>{A(null)},k=async t=>{await T(),H()},n=async t=>{try{i({type:"STAFF_LOADING"});const{success:p,error:a}=await Ue(t);a?i({type:"STAFF_ERROR",payload:a}):(i({type:"STAFF_SUCCESS",payload:r}),alert(s("staff.invitationResent")))}catch(p){i({type:"STAFF_ERROR",payload:p.message})}},c=t=>{const a={active:{color:"success",text:s("staff.status.active")},invited:{color:"warning",text:s("staff.status.invited")},inactive:{color:"secondary",text:s("staff.status.inactive")},terminated:{color:"danger",text:s("staff.status.terminated")}}[t]||{color:"secondary",text:t};return e.jsx($,{color:a.color,children:a.text})},j=t=>{const a={owner:{color:"primary",text:s("staff.roles.owner")},manager:{color:"info",text:s("staff.roles.manager")},reception:{color:"success",text:s("staff.roles.reception")},senior_employee:{color:"warning",text:s("staff.roles.seniorEmployee")},junior_employee:{color:"secondary",text:s("staff.roles.juniorEmployee")}}[t]||{color:"secondary",text:t};return e.jsx($,{color:a.color,children:a.text})},u=r.filter(t=>t.first_name.toLowerCase().includes(N.toLowerCase())||t.last_name.toLowerCase().includes(N.toLowerCase())||t.email.toLowerCase().includes(N.toLowerCase()));return D?e.jsx(Ce,{staffId:D.id,onBack:Z,onEdit:t=>{A(null),F(t)}}):U?e.jsx(be,{staff:C,onClose:H,onSuccess:k}):e.jsx(R,{children:e.jsx(m,{xs:12,children:e.jsxs(z,{className:"mb-4",children:[e.jsx(xe,{children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h4",{className:"mb-0",children:s("staff.title")}),e.jsxs(J,{color:"primary",onClick:()=>b(!0),children:[e.jsx(S,{icon:Le,className:"me-2"}),s("staff.addStaff")]})]})}),e.jsxs(G,{children:[l&&e.jsx(I,{color:"danger",dismissible:!0,children:l}),e.jsxs(R,{className:"mb-3",children:[e.jsx(m,{md:4,children:e.jsx(te,{children:e.jsx(q,{placeholder:s("staff.searchPlaceholder"),value:N,onChange:t=>w(t.target.value)})})}),e.jsx(m,{md:3,children:e.jsxs(he,{value:d.status,onChange:t=>x("status",t.target.value),children:[e.jsx("option",{value:"all",children:s("staff.filters.allStatus")}),e.jsx("option",{value:"active",children:s("staff.status.active")}),e.jsx("option",{value:"invited",children:s("staff.status.invited")}),e.jsx("option",{value:"inactive",children:s("staff.status.inactive")}),e.jsx("option",{value:"terminated",children:s("staff.status.terminated")})]})}),e.jsx(m,{md:3,children:e.jsxs(he,{value:d.role,onChange:t=>x("role",t.target.value),children:[e.jsx("option",{value:"all",children:s("staff.filters.allRoles")}),e.jsx("option",{value:"manager",children:s("staff.roles.manager")}),e.jsx("option",{value:"reception",children:s("staff.roles.reception")}),e.jsx("option",{value:"senior_employee",children:s("staff.roles.seniorEmployee")}),e.jsx("option",{value:"junior_employee",children:s("staff.roles.juniorEmployee")})]})})]}),o?e.jsx("div",{className:"text-center p-4",children:e.jsx(ne,{})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{overflowX:"auto",minHeight:"400px"},children:e.jsxs(re,{hover:!0,children:[e.jsx(ie,{children:e.jsxs(L,{children:[e.jsx(y,{children:s("staff.table.name")}),e.jsx(y,{children:s("staff.table.email")}),e.jsx(y,{children:s("staff.table.role")}),e.jsx(y,{children:s("staff.table.status")}),e.jsx(y,{children:s("staff.table.commission")}),e.jsx(y,{style:{width:"80px"},children:s("staff.table.actions")})]})}),e.jsx(le,{children:u.length===0?e.jsx(L,{children:e.jsx(g,{colSpan:"6",className:"text-center",children:s("staff.noStaffFound")})}):u.map(t=>e.jsxs(L,{children:[e.jsx(g,{children:e.jsxs("strong",{children:[t.first_name," ",t.last_name]})}),e.jsx(g,{children:t.email}),e.jsx(g,{children:j(t.role)}),e.jsx(g,{children:c(t.status)}),e.jsxs(g,{children:[t.commission_rate,"%"]}),e.jsx(g,{children:e.jsxs(Ie,{alignment:"end",direction:"up",children:[e.jsx(Oe,{size:"sm",color:"ghost",children:e.jsx(S,{icon:Ve})}),e.jsxs(qe,{children:[e.jsxs(X,{onClick:()=>O(t),children:[e.jsx(S,{icon:Xe,className:"me-2"}),s("staff.actions.viewDetails")]}),e.jsxs(X,{onClick:()=>F(t),children:[e.jsx(S,{icon:ve,className:"me-2"}),s("staff.actions.edit")]}),t.status==="invited"&&e.jsxs(X,{onClick:()=>n(t.id),children:[e.jsx(S,{icon:Pe,className:"me-2"}),s("staff.actions.resendInvitation")]}),t.status==="active"&&e.jsx(X,{onClick:()=>Q(t.id,"inactive"),children:s("staff.actions.deactivate")}),t.status==="inactive"&&e.jsx(X,{onClick:()=>Q(t.id,"active"),children:s("staff.actions.activate")}),e.jsxs(X,{className:"text-danger",onClick:()=>W(t.id),children:[e.jsx(S,{icon:He,className:"me-2"}),s("staff.actions.delete")]})]})]})})]},t.id))})]})}),u.length>0&&e.jsx("div",{className:"text-center text-muted py-3",style:{fontSize:"0.875rem",borderTop:"1px solid #d8dbe0"},children:s("staff.endOfList",{count:u.length,plural:u.length!==1?"Ã³w":""})})]})]})]})})})};export{xs as default};
