import{e as i}from"./index-Bmzq44n2.js";const g=async r=>{try{const t=new Date().toISOString().split("T")[0],s=new Date().toISOString().slice(0,7)+"-01",{data:e,error:a}=await i.from("appointments").select("id, status, total_amount").eq("business_id",r).eq("appointment_date",t);if(a)throw a;const{data:c,error:o}=await i.from("appointments").select("total_amount").eq("business_id",r).eq("status","completed").gte("appointment_date",s);if(o)throw o;const{count:u,error:l}=await i.from("clients").select("id",{count:"exact"}).eq("business_id",r).eq("is_active",!0);if(l)throw l;const{count:m,error:d}=await i.from("employees").select("id",{count:"exact"}).eq("business_id",r).eq("status","active");if(d)throw d;return{data:{todayAppointments:e.length,todayCompletedAppointments:e.filter(n=>n.status==="completed").length,todayRevenue:e.filter(n=>n.status==="completed").reduce((n,p)=>n+parseFloat(p.total_amount),0),monthlyRevenue:c.reduce((n,p)=>n+parseFloat(p.total_amount),0),totalClients:u,totalStaff:m},error:null}}catch(t){return{data:null,error:t.message}}},f=async(r,t,s)=>{try{const{data:e,error:a}=await i.from("appointments").select("appointment_date, total_amount, status").eq("business_id",r).eq("status","completed").gte("appointment_date",t).lte("appointment_date",s).order("appointment_date",{ascending:!0});if(a)throw a;return{data:e.reduce((o,u)=>{const l=u.appointment_date;return o[l]||(o[l]=0),o[l]+=parseFloat(u.total_amount),o},{}),error:null}}catch(e){return{data:null,error:e.message}}},h=async r=>{try{const{data:t,error:s}=await i.rpc("melon_get_business_analytics",{p_business_id:r});if(s)throw s;const e=t&&t.length>0?t[0]:null;return e?{data:{totalVisitors:parseInt(e.total_visitors)||0,pageViews:parseInt(e.page_views)||0,bounceRate:parseFloat(e.bounce_rate)||0}}:{totalVisitors:0,pageViews:0,bounceRate:0}}catch(t){return{data:null,error:t.message}}},w=async r=>{try{const{data:t,error:s}=await i.rpc("melon_get_device_analytics",{p_business_id:r});if(s)throw s;const e={browsers:[],devices:[],os:[]};return t&&t.length>0&&t.forEach(a=>{const c={type:a.type,count:parseInt(a.count)||0};a.category==="browser"?e.browsers.push(c):a.category==="device"?e.devices.push(c):a.category==="os"&&e.os.push(c)}),{data:e,error:null}}catch(t){return{data:null,error:t.message}}};export{f as a,h as b,w as c,g};
