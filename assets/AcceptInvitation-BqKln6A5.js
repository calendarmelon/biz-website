import{j as e,C as h,N as b}from"./index-BheFCFOF.js";import{j as M,u as V,a as o}from"./vendor-CMvHcHbC.js";import{b as p,a as k,c as P}from"./index.esm-CuCM43ir.js";import{v as $,a as G}from"./staff-D8zrfuMw.js";import{u as J}from"./storage-B4ijfEY4.js";import{d as j,b as I,c as g,a as A}from"./CRow-F-29Amx2.js";import{d as T,e as E,c as O,b as Q}from"./CForm-B94iwgBD.js";import{c as W}from"./cil-check-circle-BlU9eaow.js";import{C as X}from"./CCardHeader-CN94IKlH.js";import{c as Y}from"./cil-user-Ddrdy7PS.js";import{c as S}from"./cil-lock-locked-DmxpJbVL.js";import"./redux-IAqEd8mO.js";const Z=i=>i.toLowerCase().replace(/_([a-z])/g,(l,t)=>t.toUpperCase()),w=(i,l=null)=>{if(console.log("Accept Invitation Error Mapper:",{errorCode:i,errorMessage:l}),i&&typeof i=="string")return`acceptInvitation.errors.${Z(i)}`;if(l){const t=l.toLowerCase();if(t.includes("invalid")&&t.includes("token"))return"acceptInvitation.errors.invalidInvitationToken";if(t.includes("expired"))return"acceptInvitation.errors.invitationExpired";if(t.includes("already been accepted"))return"acceptInvitation.errors.invitationAlreadyAccepted";if(t.includes("email")&&t.includes("match"))return"acceptInvitation.errors.emailMismatch";if(t.includes("token")&&t.includes("required"))return"acceptInvitation.errors.invitationTokenRequired";if(t.includes("email")&&t.includes("required"))return"acceptInvitation.errors.emailRequired";if(t.includes("password")&&t.includes("required"))return"acceptInvitation.errors.passwordRequired";if(t.includes("first name")&&t.includes("required"))return"acceptInvitation.errors.firstNameRequired";if(t.includes("last name")&&t.includes("required"))return"acceptInvitation.errors.lastNameRequired";if(t.includes("user")&&t.includes("already exists"))return"acceptInvitation.errors.userAlreadyExists";if(t.includes("failed to create account"))return"acceptInvitation.errors.failedToCreateAccount";if(t.includes("failed to create user profile"))return"acceptInvitation.errors.failedToCreateUserProfile";if(t.includes("failed to activate employee"))return"acceptInvitation.errors.failedToActivateEmployee";if(t.includes("network"))return"acceptInvitation.errors.networkError"}return"acceptInvitation.errors.genericError"},ue=()=>{var N,y;const i=M(),l=V(),{t}=J(),[m,f]=o.useState(!1),[q,u]=o.useState(!0),[v,n]=o.useState(""),[L,F]=o.useState(!1),[R,_]=o.useState(""),[r,K]=o.useState(null),[d,z]=o.useState({password:"",confirmPassword:""});o.useEffect(()=>{const s=new URLSearchParams(l.search).get("token");if(!s){n(t("acceptInvitation.errors.noToken")),u(!1);return}_(s),U(s)},[l]);const U=async a=>{try{const{data:s,error:c,errorCode:x}=await $(a);if(c){const H=w(x,c);n(t(H)),u(!1);return}K(s),u(!1)}catch{n(t("acceptInvitation.errors.verificationFailed")),u(!1)}},D=()=>!d.password||d.password.length<8?(n(t("acceptInvitation.errors.passwordMinLength")),!1):d.password!==d.confirmPassword?(n(t("acceptInvitation.errors.passwordMismatch")),!1):!0,B=async a=>{if(a.preventDefault(),n(""),!!D()){f(!0);try{const{error:s,errorCode:c}=await G(R,r.email,d.password,r.first_name,r.last_name);if(s){const x=w(c,s);n(t(x)),f(!1);return}F(!0),setTimeout(()=>{i(b.login)},3e3)}catch(s){const c=w(null,s.message);n(t(c))}finally{f(!1)}}},C=(a,s)=>{z(c=>({...c,[a]:s}))};return q?e.jsx("div",{className:"bg-light min-vh-100 d-flex flex-row align-items-center",children:e.jsx(j,{children:e.jsx(I,{className:"justify-content-center",children:e.jsx(g,{md:6,children:e.jsxs("div",{className:"text-center",children:[e.jsx(h,{color:"primary"}),e.jsx("p",{className:"mt-3",children:t("acceptInvitation.verifying")})]})})})})}):L?e.jsx("div",{className:"bg-light min-vh-100 d-flex flex-row align-items-center",children:e.jsx(j,{children:e.jsx(I,{className:"justify-content-center",children:e.jsx(g,{md:6,children:e.jsx(T,{children:e.jsxs(E,{className:"text-center p-5",children:[e.jsx(p,{icon:W,size:"4xl",className:"text-success mb-3"}),e.jsx("h3",{children:t("acceptInvitation.success.title",{businessName:(N=r==null?void 0:r.businesses)==null?void 0:N.name})}),e.jsx("p",{className:"text-muted",children:t("acceptInvitation.success.accountCreated")}),e.jsx("p",{className:"text-muted",children:t("acceptInvitation.success.redirecting")}),e.jsx(h,{size:"sm",className:"mt-3"})]})})})})})}):e.jsx("div",{className:"bg-light min-vh-100 d-flex flex-row align-items-center",children:e.jsx(j,{children:e.jsx(I,{className:"justify-content-center",children:e.jsx(g,{md:6,children:e.jsxs(T,{children:[e.jsx(X,{children:e.jsx("h4",{className:"mb-0",children:t("acceptInvitation.title")})}),e.jsxs(E,{className:"p-4",children:[v&&e.jsx(O,{color:"danger",dismissible:!0,children:v}),v&&e.jsx(A,{color:"primary",className:"mt-3",active:!0,tabIndex:-1,onClick:()=>i(b.login),disabled:m,children:t("acceptInvitation.buttons.loginPage")}),r&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-muted mb-2",children:[t("acceptInvitation.invitation.youAreInvited")," ",e.jsx("strong",{children:(y=r.businesses)==null?void 0:y.name})]}),e.jsxs("div",{className:"bg-light p-3 rounded",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx(p,{icon:Y,className:"me-2"}),e.jsxs("strong",{children:[r.first_name," ",r.last_name]})]}),e.jsx("p",{className:"mb-0 text-muted",children:r.email})]})]}),e.jsxs(Q,{onSubmit:B,children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs(k,{htmlFor:"password",children:[t("acceptInvitation.invitation.createPassword")," *"]}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:e.jsx(p,{icon:S})}),e.jsx(P,{type:"password",id:"password",placeholder:t("acceptInvitation.invitation.passwordPlaceholder"),value:d.password,onChange:a=>C("password",a.target.value),required:!0,disabled:m})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs(k,{htmlFor:"confirmPassword",children:[t("acceptInvitation.invitation.confirmPassword")," *"]}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:e.jsx(p,{icon:S})}),e.jsx(P,{type:"password",id:"confirmPassword",placeholder:t("acceptInvitation.invitation.confirmPasswordPlaceholder"),value:d.confirmPassword,onChange:a=>C("confirmPassword",a.target.value),required:!0,disabled:m})]})]}),e.jsx(A,{type:"submit",color:"primary",className:"w-100",disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsx(h,{size:"sm",className:"me-2"}),t("acceptInvitation.buttons.creating")]}):t("acceptInvitation.buttons.acceptAndCreate")})]})]})]})]})})})})})};export{ue as default};
